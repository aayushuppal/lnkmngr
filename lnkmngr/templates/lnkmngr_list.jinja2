<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>{{ title }}</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/logo.png') }}" type="image/x-icon" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />

    <link rel="stylesheet" href="{{ url_for('static', filename='css/lnkmngr.css') }}" />
</head>

<body class="container">
    <div class="pt-2">
        <h3>
            <a href="/" style="text-decoration:none;">
                <i class="fas fa-stream"></i>
            </a>
            {{ title }}
        </h3>
    </div>
    <hr/>

    <form action="{{ url_for('add_link_table_route') }}" method="POST">
        <input type="text" name="new_table_name"></input>
        &nbsp;|&nbsp;
        <button type="submit" name="action">
            <i class="fas fa-plus-square"></i>
        </button>
        &nbsp;|&nbsp;
        <button id="del_link_table">
            <i class="fas fa-trash-alt"></i>
        </button>
        &nbsp;|&nbsp;
        <input id="edit_new_table_name" type="text" />&nbsp;
        <button id="edit_btn_id">
            <i class="fas fa-pen-square"></i>
        </button>
    </form>
    <br/>

     {% if link_tables %}
        <div id="link_tables">
        <ul>
        {% for lp in link_tables %}
            <li>
                <input type="checkbox" id={{ lp[0] }} value={{ lp[0] }} />
                &nbsp;
                <a href={{ lp[0] }}>{{ lp[1] }}</a>
            </li>
        {% endfor %}
        </ul>
        </div>
    {% endif %}
    <br/><br/>

    <script>
        $('#del_link_table').on('click', function (e) {
            e.preventDefault();
            var tl = $("#link_tables").find("input");
            tl = Array.from(tl);
            var del_tables_list = []
            tl.forEach(t => {
                if (t.checked == true) {
                    del_tables_list.push(t.value);
                }
            });

            $.ajax("/drop_link_table_route/", {
                data: JSON.stringify({
                    "table_names": del_tables_list,
                }),
                contentType: 'application/json',
                type: 'POST',
            }).done(function (response) {
                location.reload(true);
            });
        });


        $('#edit_btn_id').on('click', function (e) {
            e.preventDefault();
            var tl = $("#link_tables").find("input");
            tl = Array.from(tl);
            var edit_table_name = null;
            var is_multiple_selected = false;
            tl.forEach(t => {
                if (t.checked == true) {
                    if (edit_table_name != null) {
                        is_multiple_selected = true;
                    }
                    edit_table_name = t.value;
                }
            });

            if (!is_multiple_selected) {
                $.ajax("/edit_table_name_route/", {
                    data: JSON.stringify({
                        "table_name": edit_table_name,
                        "new_table_name": $("#edit_new_table_name").val()
                    }),
                    contentType: 'application/json',
                    type: 'POST',
                }).done(function (response) {
                    location.reload(true);
                });
            }
        });
    </script>
</body>

</html>
